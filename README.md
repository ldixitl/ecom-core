# Проект *EcomCore*

## Описание

*EcomCore* — это основа для e-commerce приложений. Этот проект содержит базовые классы для работы с товарами, категориями и заказами, а также систему загрузки данных из JSON. В дальнейшем его можно использовать для создания интернет-магазинов с любым интерфейсом, включая веб-сайты и ботов.

## Реализованные функции

### Абстрактные классы (`abstract.py`)
- **Класс `BaseProduct`** – абстрактный базовый класс для всех товаров.
  - **Абстрактный метод `__str__`** – должен быть реализован в потомках.
  - **Абстрактный метод `new_product`** – создание или обновление товара.
- **Класс `BaseEntity`** – базовый класс для сущностей с названием и описанием.

### Миксины (`mixins.py`)
- **Класс `LoggingMixin`** – выводит в консоль информацию о создании объекта.
  - **Метод `__repr__`** – возвращает строковое представление объекта.

### Модели (`models.py`)
- **Класс `Product`** – описывает товар:
  - Наследует `BaseProduct` и `LoggingMixin`, реализует методы `__str__` и `new_product`.
  - **Метод `__add__`** – складывает товары одного типа по стоимости.
  - **Геттер `price`** – безопасный доступ к цене.
  - **Сеттер `price`** – позволяет менять цену с проверкой.
  - **Обработка исключений** – выбрасывает `ZeroQuantityError`, если количество товара равно нулю.
- **Класс `Smartphone`** – расширяет `Product`, добавляя:
  - Производительность (`efficiency`), модель (`model`), память (`memory`), цвет (`color`).
  - **Метод `__str__`** – строковое представление смартфона.
- **Класс `LawnGrass`** – расширяет `Product`, добавляя:
  - Страну производства (`country`), срок прорастания (`germination_period`), цвет (`color`).
  - **Метод `__str__`** – строковое представление газонной травы.
- **Класс `Category`** – управляет категориями товаров.
  - Подсчитывает общее количество категорий и товаров.
  - **Метод `add_product`** – добавляет товар в категорию.
  - **Геттер `products`** – возвращает список товаров.
- **Класс `CategoryIterator`** – итератор для перебора товаров в категории.

### Заказы (`orders.py`)
- **Класс `Order`** – управляет заказами.
  - Наследует `BaseEntity`, содержит ссылку на `Product`, количество и итоговую стоимость.
  - **Проверка наличия товара** – если на складе недостаточно единиц, выбрасывает `ValueError`.
  - **Проверка количества** – если количество товара в заказе равно нулю, выбрасывает `ZeroQuantityError`.
  - **Метод `__str__`** – строковое представление заказа.

### Исключения (`exceptions.py`)
- **Класс `ZeroQuantityError`** – выбрасывается при попытке создать товар или оформить заказ с нулевым количеством.

### Тесты

- **Тестирование моделей (`test_models.py`)**: проверка создания объектов товаров, операций с ними (сложение, добавление в категории), а также работы с категориями и ценами.
- **Тестирование заказов (`test_orders.py`)**: проверка создания заказа, проверки запасов, обработки `ZeroQuantityError` и изменения количества товара.
- **Тестирование загрузки данных (`test_utils.py`)**: проверка чтения JSON и создания объектов.
- **Тестирование миксинов (`test_mixins.py`)**: тестирование логирования создания объектов товаров.

## Установка
1. Клонируйте репозиторий:
```sh
git clone https://github.com/ldixitl/ecom-core.git
```
Используется Poetry для управления зависимостями. Убедитесь, что Poetry установлен.
После установки выполните:
2. Установите зависимости:
```sh
poetry install
```

## Использование
Для загрузки данных из JSON выполните:
```python
from src.utils import read_json, create_objects_from_json

data = read_json("products.json")
categories = create_objects_from_json(data)
print(categories)
```

Добавить или обновить товар:
```python
from src.models import Product

data = {"name": "Ноутбук", "description": "Игровой", "price": 120000, "quantity": 5}  
product = Product.new_product(data)  
```

Создание заказа:
```python
from src.models import Product
from src.orders import Order

product = Product("Телефон", "Смартфон с OLED-дисплеем", 50000, 10)
order = Order(product, 2)
print(order)  # Выводит информацию о заказе
```

Перебор товаров в категории с помощью итератора:
```python
from src.models import CategoryIterator

iterator = CategoryIterator(category)
for product in iterator:
    print(product)
```

Вычисление средней цены товаров в категории
```python
from src.models import Category, Product

# Создаем категорию с товарами
category = Category("Электроника", "Гаджеты и аксессуары")
category.add_product(Product("Смартфон", "Флагманский смартфон", 90000, 5))
category.add_product(Product("Наушники", "Беспроводные", 15000, 10))
category.add_product(Product("Чехол", "Силиконовый", 2000, 20))

# Вычисляем среднюю цену товаров в категории
average_price = category.avg_price()
print(f"Средняя цена товаров в категории '{category.name}': {average_price} руб.")
```

## Тестирование
Для тестирования в проекте используются **pytest** и плагин **pytest-cov** для измерения покрытия кода тестами.

### Запуск тестов
Для запуска тестов используйте:
```bash
pytest
```

### Отчёт о покрытии кода
Для генерации отчёта о покрытии кода в формате HTML выполните:

```bash
pytest --cov=src --cov-report=html
```
После выполнения команда сгенерирует папку **htmlcov**, содержащую отчёт. 
Откройте файл **htmlcov/index.html** в браузере, чтобы просмотреть детализированный отчёт.

## Лицензия
Этот проект распространяется под [лицензией MIT](LICENSE).
